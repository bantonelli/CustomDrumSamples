<!DOCTYPE html>
<html ng-app="kitbuilder">
<head lang="en">
    <meta charset="UTF-8">
    <title>Ajax</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.28/angular.min.js"></script>
    <script>
        var app = angular.module("kitbuilder", []);

        app.controller("defaultCtrl", function ($scope, $http) {

            var config = {
                headers: {
                    Authorization: "Bearer GDQvVzIayprssvP9rbYDmVL0rwUTM8"
                }
            }

            $scope.loadData = function () {
                $http.get("/api/kits/?format.json", config).success(function (data) {
                    $scope.kits = data;
                });
            }
        });

        app.directive('embedSrc', function () {
          return {
            restrict: 'A',
            link: function (scope, element, attrs) {
              var current = element;
              scope.$watch(attrs.embedSrc, function () {
                var clone = element
                              .clone()
                              .attr('src', attrs.embedSrc);
                current.replaceWith(clone);
                current = clone;
              });
            }
          };
        })
    </script>
</head>
<body ng-controller="defaultCtrl">
    <div class="container panel panel-default">
        {% verbatim %}
        <div class="row" ng-repeat="kit in kits">
            {{ kit }}
            <div class="col-xs-12">{{ kit.name }}</div>
            <iframe width="100%" height="450" scrolling="no" frameborder="no" embedSrc="{{ kit.soundcloud }}"></iframe>
            <img class="col-xs-12" ng-src="{{ '/media/' + kit.image }}">
            <div class="col-xs-12">{{ kit.on_sale }}</div>
        </div>
        <div class="panel-body">
            <p><button class="btn btn-primary"ng-click="loadData()">Load Data</button></p>
        </div>
        {% endverbatim %}
    </div>
</body>
</html>